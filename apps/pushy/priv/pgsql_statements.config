%% -*- mode:erlang, erlang-indent-level: 4;indent-tabs-mode: nil -*-
%% ex: ft=erlang ts=4 sw=4 et

%% Jobs Queries
{find_job_by_id,
 <<"SELECT jobs.id, jobs.org_id, jobs.command, jobs.quorum, jobs.status, jobs.run_timeout,"
   " jobs.last_updated_by, jobs.created_at, jobs.updated_at,"
   " job_nodes.node_name, job_nodes.status AS job_node_status,"
   " job_nodes.created_at, job_nodes.updated_at"
   " FROM jobs"
   " LEFT OUTER JOIN job_nodes ON job_nodes.job_id = jobs.id"
   " WHERE jobs.id = $1">>}.

{find_jobs_by_org,
 <<"SELECT id, created_at, status",
   " FROM jobs",
   " WHERE (org_id = $1)">>}.

{insert_job,
 <<"INSERT INTO jobs (id, org_id, command, quorum, status, run_timeout,"
   " last_updated_by, created_at, updated_at)"
   " VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)">>}.

{update_job_by_id,
 <<"UPDATE jobs SET status= $1, last_updated_by= $2, updated_at= $3"
   " WHERE (id= $4)">>}.

{insert_job_node,
 <<"INSERT INTO job_nodes (job_id, org_id, node_name, status,"
   " created_at, updated_at)"
   " VALUES ($1, $2, $3, $4, $5, $6)">>}.

{update_job_node_by_orgid_nodename_jobid,
 <<"UPDATE job_nodes SET status= $1, updated_at= $2"
   " WHERE (org_id= $3 AND node_name= $4 AND job_id= $5)">>}.
